import{_ as S,m as h,g as L,u as g,s as p,a as V,h as I,q as b,G as f,J as A,r as d,i as F,o as c,c as l,b as e,t as n,w as N,j as x,A as v,n as U,k as u,d as _,e as q,K as E,F as M,l as P}from"./index-1172c7cc.js";const T={beforeMount(t,s){w(t,s)},updated(t,s){w(t,s)}};function w(t,s){t.classList=t.className.split(" ").filter(r=>!r.startsWith("fa")).join(" "),t.classList.add("fa",`fa-${s.value.icon}`),s.value.full&&(t.classList="",t.classList.add(s.value)),s.value.button&&t.classList.add("hover:scale-110")}const $={name:"Song",directives:{"icon-secondary":T},data(){return{song:{},comments:[],sort:"1",schema:{comment:"required|min:3"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"",comment_progress_variant:"bg-gradient-to-r from-zinc-900 from-0% to-[#5038a0] to-30%",comment_error_variant:"bg-red-500",comment_success_variant:"bg-[#1ed760]",comment_alert_msg:"",initial_msg:"Publishing your comment... ",success_msg:"Your comment has been published."}},computed:{...h(L,["userLoggedIn"]),...h(g,["playing"]),sortedComments(){return this.comments.slice().sort((t,s)=>this.sort==="1"?new Date(s.date)-new Date(t.date):new Date(t.date)-new Date(s.date))}},async beforeRouteEnter(t,s,r){const m=await p.doc(t.params.id).get();r(o=>{if(!m.exists){o.$router.push({name:"home"});return}const{sort:a}=o.$route.query;o.sort=a==="1"||a==="2"?a:"1",o.song=m.data()})},async created(){this.getComments()},methods:{...V(g,["play","toggleAudio"]),greeting(){return I()},async publishComment(t,{resetForm:s}){this.initCommentAlert();const r={content:t.comment,date:new Date().toString(),songID:this.$route.params.id,name:b.currentUser.displayName,uid:b.currentUser.uid};await f.add(r),this.song.comment_count+=1,await p.doc(this.$route.params.id).update({comment_count:this.song.comment_count}),this.getComments(),this.comment_in_submission=!1,this.comment_alert_variant=this.comment_success_variant,this.comment_alert_msg=this.success_msg,s(),setTimeout(()=>{this.comment_show_alert=!1},1e3)},initCommentAlert(){this.comment_show_alert=!0,this.comment_in_submission=!0,this.comment_alert_variant=this.comment_progress_variant,this.comment_alert_msg=this.initial_msg},async getComments(){const t=await f.where("songID","==",this.$route.params.id).get();this.comments=[],t.forEach(s=>{this.comments.push({docID:s.id,...s.data()})})},getCommentPublishDate(t){return A(t.date)}},watch:{sort(t){t!==this.$route.query.sort&&this.$router.push({query:{sort:t}})}}},B={class:"flex flex-col"},j={class:"w-full px-6 pb-10 text-white bg-gradient-1"},z={class:"pt-10 pb-10 font-circular-black text-xl sm:text-2xl lg:text-4xl"},G={class:"w-full flex items-center"},R={class:"text-[#1ed760] text-5xl sm:text-8xl bg-black rounded-full"},J={class:"text-left px-4"},K={class:"text-lg font-circular-black"},W={class:"text-2xl md:text-4xl lg:text-6xl font-circular-black"},Y={class:"text-sm font-circular-black"},H={class:"font-circular-thin"},O={class:"flex-1 py-5 font-circular-thin text-white bg-gradient-2",id:"comments"},Q={class:""},X={class:"px-6 pb-5 font-bold border-b border-slate-500"},Z={class:"card-title"},tt=e("i",{class:"fa-regular fa-comment float-right text-2xl"},null,-1),et={class:"p-6"},st=["disabled"],ot={value:"1"},nt={value:"2"},at={class:""},it={class:"px-6 font-circular-thin text-white"},rt={key:0,class:"p-6 border border-slate-500"},ct={key:0},lt={class:"mb-5"},mt={class:"font-bold"},dt={class:"text-sm"};function ut(t,s,r,m,o,a){const y=d("VeeField"),C=d("ErrorMessage"),k=d("VeeForm"),D=F("icon-secondary");return c(),l("main",B,[e("section",j,[e("h1",z,n(a.greeting()),1),e("div",G,[e("button",{onClick:s[0]||(s[0]=N(i=>t.play(o.song),["prevent"])),type:"button"},[x(e("i",R,null,512),[[D,{icon:"play-circle",button:!0}]])]),e("div",J,[e("h2",K,n(t.$t("song.viewTitle")),1),e("div",W,n(o.song.modified_name),1),e("div",Y,[v(n(o.song.artist??"Unknown artist")+" ",1),e("span",H,n(o.song.genre??"Unknown Genre"),1)])])])]),e("section",O,[e("div",Q,[e("div",X,[e("span",Z,n(t.$tc("song.commentCount",{count:o.song.comment_count})),1),tt]),e("div",et,[o.comment_show_alert?(c(),l("div",{key:0,class:U(["text-white text-center p-4 mb-4",o.comment_alert_variant])},n(o.comment_alert_msg),3)):u("",!0),_(k,{"validation-schema":o.schema,onSubmit:a.publishComment},{default:q(()=>[_(y,{as:"textarea",name:"comment",class:"block w-full py-1.5 px-3 text-white border border-transparent transition duration-500 focus:outline-none focus:border-white rounded mb-4",placeholder:t.$t("song.commentPlaceholder")},null,8,["placeholder"]),_(C,{class:"text-red-600",name:"comment"}),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:o.comment_in_submission},n(t.$t("song.publish")),9,st)]),_:1},8,["validation-schema","onSubmit"]),x(e("select",{class:"block mt-6 py-1.5 px-3 text-white border border-transparent transition duration-500 focus:outline-none focus:border-white rounded","onUpdate:modelValue":s[1]||(s[1]=i=>o.sort=i)},[e("option",ot,n(t.$t("song.latest")),1),e("option",nt,n(t.$t("song.oldest")),1)],512),[[E,o.sort]])])]),e("div",at,[e("ul",it,[o.comments.length===0?(c(),l("li",rt,[v(n(t.$t("song.noComments"))+" ",1),t.userLoggedIn?u("",!0):(c(),l("span",ct," Login or Register to leave a comment."))])):u("",!0),(c(!0),l(M,null,P(a.sortedComments,i=>(c(),l("li",{class:"p-6 border border-slate-500",key:i.docID},[e("div",lt,[e("div",mt,n(i.name),1),e("time",dt,n(this.getCommentPublishDate(i)),1)]),e("p",null,n(i.content),1)]))),128))])])])])}const ht=S($,[["render",ut]]);export{ht as default};
