import{m,u as f,a as D,f as q,R as j,_ as k,r as S,o as a,c,b as e,n as u,t as l,w as b,d as _,e as y,g as I,h as R,i as B,j as E,k as v,F as U,l as H,p as P,s as w,q as p,v as z}from"./index-19e6b87f.js";const N="/musicfy/assets/img/equaliser-animated-green.gif",O={name:"SongItem",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},isSelected:{type:Boolean,required:!0}},emits:["double-click"],computed:{...m(f,["getCurrentSong","isPlaying"]),isSongInPlayer(){return this.getCurrentSong.docID===this.song.docID},isSongPlaying(){return this.isSongInPlayer&&this.isPlaying}},methods:{...D(f,["play","toggleAudio"]),getDuration(){return q(this.song.duration??0)},handleDblClick(t){this.$emit("double-click"),this.play(t)}},components:{RouterLink:j}},V={class:"flex justify-center items-center"},M={key:0,class:"group-hover:hidden"},F={key:1,src:N,alt:"Sound wave",class:"group-hover:hidden w-3.5"},T={class:"overflow-x-clip text-ellipsis"},W=["onClick"],$={class:"flex justify-end items-center gap-4"},G=e("i",{class:"!hidden sm:!block fa-solid fa-heart text-green-500"},null,-1),J={class:"hidden sm:block w-9"};function K(t,n,s,g,h,o){const r=S("RouterLink");return a(),c("tr",{class:u(["group hover:cursor-pointer",{"bg-white bg-opacity-30 ":s.isSelected,"sm:hover:bg-white sm:hover:bg-opacity-10 sm:hover:text-white secondary-text":!s.isSelected}])},[e("td",{id:"index",class:u(["hidden sm:table-cell rounded-l-md",{"text-green-500":o.isSongInPlayer,"text-secondary":!o.isSongInPlayer}]),onClick:n[0]||(n[0]=b(i=>o.isSongInPlayer?t.toggleAudio():t.play(s.song),["prevent"]))},[e("div",V,[e("i",{class:u(["!hidden group-hover:!block fa-solid text-white text-sm",{"fa-pause ":o.isSongPlaying,"fa-play":!o.isSongPlaying}])},null,2),o.isSongPlaying?(a(),c("img",F)):(a(),c("p",M,l(s.index+1),1))])],2),e("td",{id:"title",onDblclick:n[1]||(n[1]=i=>o.handleDblClick(s.song)),class:"rounded-l-md sm:rounded-none px-2"},[_(r,{to:{name:"song",params:{id:s.song.docID}},class:"text-white w-max border-b border-b-transparent hover:border-b-white"},{default:y(()=>[e("span",{class:u(["overflow-x-clip text-ellipsis",{"text-white":!o.isSongInPlayer,"text-green-500":o.isSongInPlayer}])},l(s.song.modified_name),3)]),_:1},8,["to"]),_(r,{to:{name:"song",params:{id:s.song.docID}},class:"block w-max border-b border-b-transparent hover:border-b-white text-sm"},{default:y(()=>[e("span",T,l(s.song.artist||t.$t("home.unknown")),1)]),_:1},8,["to"])],32),e("td",{id:"genre",onDblclick:n[2]||(n[2]=i=>o.handleDblClick(s.song)),class:"hidden sm:table-cell"},l(s.song.genre||t.$t("home.unknown")),33),e("td",{id:"comments",onDblclick:n[3]||(n[3]=i=>o.handleDblClick(s.song)),class:"hidden sm:table-cell"},[_(r,{custom:"",to:{name:"song",params:{id:s.song.docID},hash:"#comments"}},{default:y(({navigate:i})=>[e("span",{onClick:i,class:"hover:underline"},l(s.song.comment_count),9,W)]),_:1},8,["to"])],32),e("td",{id:"duration",onDblclick:n[5]||(n[5]=i=>o.handleDblClick(s.song)),class:"rounded-r-md px-2"},[e("div",$,[G,e("i",{class:u(["sm:!hidden fa-solid text-white text-xl",{"fa-pause":o.isSongPlaying,"fa-play":!o.isSongPlaying}]),onClick:n[4]||(n[4]=b(i=>o.isSongInPlayer?t.toggleAudio():t.play(s.song),["prevent"]))},null,2),e("p",J,l(o.getDuration()),1)])],32)],2)}const Q=k(O,[["render",K]]),x="/musicfy/assets/img/liked-songs-300.webp",C="/musicfy/assets/img/liked-songs-640.webp",X={name:"AppPlaylist",components:{SongItem:Q},props:{songs:{type:Array,required:!0},songsCount:{type:Number,required:!0}},data(){return{selectedSong:"",downladed:!1}},computed:{...m(f,["playing","playerHasSong"]),...m(I,["username"])},methods:{...D(f,["play","toggleAudio"]),greeting(){return R()},isSongSelected(t){return this.selectedSong===t},selectSong(t){this.selectedSong=this.selectedSong===t?null:t},handleDblClick(t){this.selectSong(t.docID),this.play(t)},downloadSongs(){this.songs.forEach(async t=>{if(!localStorage.getItem(t.id)){const s=await(await fetch(t.url)).blob(),g=URL.createObjectURL(s);localStorage.setItem(t.id,g)}}),this.downladed=!0}}},Y=x+" 150w, "+x+" 300w, "+C+" 320w, "+C+" 640w",Z={class:"flex flex-col"},ee={class:"px-4 pb-5 text-white font-circular-thin bg-gradient-1"},te={class:"pt-10 pb-10 font-circular-black text-xl sm:text-2xl lg:text-4xl"},se={class:"container flex justify-between items-end sm:gap-6"},ne=e("img",{"aria-hidden":"false",draggable:"false",loading:"eager",src:x,alt:"Liked songs",class:"shadow-3xl order-2 sm:order-1 w-28 h-28 sm:w-max sm:h-max",srcset:Y,sizes:"(min-width: 1280px) 232px, 192px"},null,-1),oe={class:"text-white main-header-content flex flex-col sm:grow gap-1 sm:gap-4 justify-center items-start order-1"},le={class:"text-xs sm:text-base"},ie={class:"text-xl sm:text-4xl lg:text-7xl font-circular-black text-left"},ae={class:"text-xs sm:text-base"},re={class:"font-circular-regular"},de={class:"flex-1 py-5 bg-zinc-900 bg-opacity-30 font-circular-thin bg-gradient-2"},ce={class:"flex justify-between mx-4 sm:mx-8"},ge={type:"button",class:"md:hover:scale-105"},he=e("i",{class:"fa-regular fa-circle-down"},null,-1),ue=e("span",{class:"font-circular-black"}," Download songs",-1),me=[he,ue],fe={class:"mx-4 sm:mx-8 mt-4"},be={id:"playlist",class:"w-full text-left"},_e={class:"border-b border-zinc-400 border-opacity-10 secondary-text"},ye=e("th",{class:"hidden sm:table-cell px-4 sm:w-8 font-light"},"#",-1),we={class:"sm:w-2/5 p-1 font-light"},pe={class:"hidden sm:table-cell w-1/3 font-light"},xe={class:"hidden sm:table-cell w-1/5 font-light"},ke=e("th",{class:"hidden sm:table-cell w-2/12 font-light"},[e("div",{class:"flex justify-end mr-2 font-light"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 secondary-text","aria-label":"duration"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1),Se={class:"text-white"},ve=e("tr",{class:"h-2"},null,-1),Ce={colspan:"5"},De={key:0};function Ie(t,n,s,g,h,o){const r=S("SongItem"),i=B("icon");return a(),c("main",Z,[e("section",ee,[e("h1",te,l(o.greeting()),1),e("div",se,[ne,e("div",oe,[e("h4",le,l(t.$t("home.playlist")),1),e("h1",ie,l(t.$t("home.liked")),1),e("p",ae,[e("span",re,l(t.username)+" ยบ "+l(s.songsCount)+" "+l(t.$t("home.songs")),1)])])])]),e("section",de,[e("div",ce,[e("button",ge,[E(e("i",{class:"text-[#1ed760] text-5xl bg-black rounded-full",onClick:n[0]||(n[0]=b(d=>t.playerHasSong?t.toggleAudio():t.play(this.songs[0]),["prevent"]))},null,512),[[i,t.playing?"pause-circle":"play-circle",void 0,{button:!0}]])]),h.downladed?v("",!0):(a(),c("button",{key:0,class:"text-gray-300 hover:text-white md:hover:scale-105",onClick:n[1]||(n[1]=b(d=>o.downloadSongs(),["prevent"]))},me))]),e("div",fe,[e("table",be,[e("thead",_e,[e("tr",null,[ye,e("th",we,l(t.$t("home.title")),1),e("th",pe,l(t.$t("home.genre")),1),e("th",xe,l(t.$t("home.comments")),1),ke])]),e("tbody",Se,[ve,(a(!0),c(U,null,H(s.songs,(d,A)=>(a(),P(r,{key:d.docID,song:d,index:A,"is-selected":o.isSongSelected(d.docID),onClick:L=>o.selectSong(d.docID),onDoubleClick:L=>o.handleDblClick(d)},null,8,["song","index","is-selected","onClick","onDoubleClick"]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Ce,[s.songs.length===0?(a(),c("span",De,l(t.$t("home.emptyPlaylist")),1)):v("",!0)])])])])])])])}const Pe=k(X,[["render",Ie]]),Ae={name:"Home",components:{AppPlaylist:Pe},data(){return{songs:[],maxPerPage:10,pendingReq:!1,songsCount:0}},computed:{...m(I,["userLoggedIn"])},async created(){await this.getSongs(),await this.getSongsCount(),window.addEventListener("scroll",this.handleScroll)},methods:{async getSongs(){if(this.pendingReq||!this.userLoggedIn)return;this.pendingReq=!0;let t;if(this.songs.length){const n=await w.doc(this.songs[this.songs.length-1].docID).get();t=await w.where("uid","==",p.currentUser.uid).orderBy("modified_name").startAfter(n).limit(this.maxPerPage).get(),t.forEach(s=>{this.songs.push({docID:s.id,...s.data()})})}else t=await w.where("uid","==",p.currentUser.uid).orderBy("modified_name").limit(this.maxPerPage).get(),t.forEach(n=>{this.songs.push({docID:n.id,...n.data()})});this.pendingReq=!1},async getSongsCount(){this.userLoggedIn&&await z.doc(p.currentUser.uid).get().then(t=>{this.songsCount=t.data().songsCount??0}).catch(()=>{this.songsCount=0,console.error("Error getting user's songs count ")})},handleScroll(){const{scrollTop:t,offsetHeight:n}=document.documentElement,{innerHeight:s}=window;Math.ceil(t)+s>=n&&this.getSongs()}},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)}};function Le(t,n,s,g,h,o){const r=S("AppPlaylist");return a(),P(r,{songs:h.songs,songsCount:h.songsCount},null,8,["songs","songsCount"])}const je=k(Ae,[["render",Le]]);export{je as default};
