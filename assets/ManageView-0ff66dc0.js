import{_ as y,G as F,y as _,x as v,z as D,H as E,o as g,c as m,b as t,t as d,n as f,w as u,D as V,F as $,q as I,J as z,K as L,r as b,l as C,L as k,p as N,d as h,e as q,v as A}from"./index-2a77d9da.js";const M={name:"Upload",props:{addSong:{type:Function,required:!0}},data(){return{is_dragover:!1,uploads:[]}},methods:{upload(s){this.is_dragover=!1,(s.dataTransfer?[...s.dataTransfer.files]:[...s.target.files]).forEach(async r=>{if(!navigator.onLine){this.uploads.push({task:{},current_progress:100,name:r.name,variant:"progress-bar bg-red-400",icon:"fas fa-times",text_class:"text-red-400"}),alert("You are offline, please check your internet connection");return}if(r.type!="audio/mpeg"){alert("file type invalid");return}const a=F.ref().child("songs").child(`${r.name}`);if(await this.fileExists(r)){alert("Song already existing:",r.name);return}const c=a.put(r),i=this.uploads.push({task:c,current_progress:0,name:r.name,variant:"progress-bar bg-green-400",icon:"fa-solid fa-spinner fa-spin",text_class:"",hide_class:""})-1;c.on("state_changed",l=>{const x=l.bytesTransferred/l.totalBytes*100;this.uploads[i].current_progress=x},()=>{this.uploads[i].variant="bg-red-400",this.uploads[i].icon="fas fa-times",this.uploads[i].text_class="text-red-400",console.error("Error uploading the song")},async()=>{const l=await c.snapshot.ref.getDownloadURL(),x=new Audio(l),R=await new Promise(w=>{x.addEventListener("loadedmetadata",()=>{w(x.duration)})}),U={uid:_.currentUser.uid,displayName:_.currentUser.displayName,original_name:c.snapshot.ref.name,modified_name:this.getFileNameWithoutExtension(c.snapshot.ref.name),genre:"",artist:"",comment_count:0,duration:R,url:l};let S="";await v.add(U).then(w=>{S=w,D.doc(_.currentUser.uid).update({songsCount:E.increment(1)})}).catch(async()=>{this.uploads[i].variant="bg-red-400",this.uploads[i].icon="fas fa-times",this.uploads[i].text_class="text-red-400",console.error("Error uploading the song"),await a.delete()});const H=await S.get();this.addSong(H),this.uploads[i].variant="bg-green-400",this.uploads[i].icon="fas fa-check",this.uploads[i].text_class="text-green-400",setTimeout(()=>{this.uploads[i].hide_class="hidden"},1e3)})})},getFileNameWithoutExtension(s){return s.replace(/\.[^.]+$/,"")},async fileExists(s){return(await v.where("uid","==",_.currentUser.uid).where("original_name","==",s.name).get()).size!==0},cancelUploads(){this.uploads.forEach(s=>{s.task.cancel()})},openInputFile(){this.$refs.inputFile.click()}},beforeUnmount(){this.cancelUploads()}},T={class:"col-span-1"},B={class:"bg-zinc-900 rounded-lg shadow-inner shadow-slate-500 relative flex flex-col text-white"},P={class:"px-6 pt-6 pb-5 font-bold border-b border-slate-400"},Y={class:"card-title"},j=t("i",{class:"fas fa-upload float-right text-green-400 text-2xl"},null,-1),G={class:"p-6"},W={class:"block text-sm"},J=t("hr",{class:"my-6 border-slate-400"},null,-1),K={class:"flex h-4 overflow-hidden bg-gray-200 rounded"};function O(s,e,r,p,n,a){return g(),m("main",T,[t("div",B,[t("div",P,[t("span",Y,d(s.$t("manage.upload")),1),j]),t("div",G,[t("div",{class:f(["w-full px-5 py-10 md:px-10 lg:py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-zinc-700 hover:border-solid",{"bg-zinc-700 text-white border border-solid":n.is_dragover}]),onDrag:e[0]||(e[0]=u(()=>{},["prevent","stop"])),onDragstart:e[1]||(e[1]=u(()=>{},["prevent","stop"])),onDragend:e[2]||(e[2]=u(o=>n.is_dragover=!1,["prevent","stop"])),onDragover:e[3]||(e[3]=u(o=>n.is_dragover=!0,["prevent","stop"])),onDragenter:e[4]||(e[4]=u(o=>n.is_dragover=!0,["prevent","stop"])),onDragleave:e[5]||(e[5]=u(o=>n.is_dragover=!1,["prevent","stop"])),onDrop:e[6]||(e[6]=u(o=>a.upload(o),["prevent","stop"])),onClick:e[7]||(e[7]=u((...o)=>a.openInputFile&&a.openInputFile(...o),["prevent"]))},[t("h5",null,[V(d(s.$t("manage.dropHintMsg1")),1),t("span",W,d(s.$t("manage.dropHintMsg2")),1)])],34),t("input",{type:"file",multiple:"",ref:"inputFile",onChange:e[8]||(e[8]=o=>a.upload(o)),class:"hidden w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:font-semibold file:bg-green-500 hover:file:bg-green-400 bg-gray-800 hover:cursor-pointer"},null,544),J,(g(!0),m($,null,I(n.uploads,o=>(g(),m("div",{class:f(["mb-4",o.hide_class]),key:o.name},[t("div",{class:f(["font-bold text-sm",o.text_class])},[t("i",{class:f(o.icon)},null,2),t("span",null,d(o.name),1)],2),t("div",K,[t("div",{class:f(["transition-all",o.variant]),style:z({width:o.current_progress+"%"})},null,6)])],2))),128))])])])}const Q=y(M,[["render",O]]),X={name:"CompositionItem",props:{song:{type:Object,required:!0},updateSong:{type:Function,required:!0},removeSong:{type:Function,required:!0},index:{type:Number,required:!0},updateHasChanges:{type:Function}},data(){return{showForm:!1,songSchema:{modified_name:"required",genre:"alpha_spaces",artist:""},initialValues:{modified_name:this.song.modified_name,artist:this.song.artist,genre:this.song.genre},in_submission:!1,show_alert:!1,alert_variant:"bg-gradient-to-r from-zinc-900 from-0% to-[#5038a0] to-30%",progress_variant:"bg-gradient-to-r from-zinc-900 from-0% to-[#5038a0] to-30%",error_variant:"bg-red-500",success_variant:"bg-[#1ed760]",alert_msg:"",initial_msg:"Please wait! Updating song. ",success_msg:"Success! Your song info was updated."}},methods:{async deleteSong(){this.in_submission=!0,await F.ref().child(`songs/${this.song.original_name}`).delete().then(()=>{D.doc(_.currentUser.uid).update({songsCount:E.increment(-1)}),L.where("songID","==",this.song.docID).get().then(p=>{p.forEach(n=>{n.ref.delete()})})}).catch(()=>{console.error("Error deleting song"),this.in_submission=!1}),await v.doc(this.song.docID).delete().then(()=>{}).catch(()=>{console.error("Error deleting song"),this.in_submission=!1}),this.removeSong(this.index),this.in_submission=!1},async editSong(s){this.initAlert();try{if(!this.hasChanges(s)){this.show_alert=!1,this.showForm=!1;return}await v.doc(this.song.docID).update({modified_name:s.modified_name,artist:s.artist??"",genre:s.genre??""})}catch{this.alert_variant=this.error_variant,this.alert_msg="Something went wrong! Try again later.";return}finally{this.in_submission=!1}this.updateSong(this.index,s),this.updateHasChanges(!1),this.alert_variant=this.success_variant,this.alert_msg=this.success_msg,this.show_alert=!1,this.showForm=!1},initAlert(){this.show_alert=!0,this.in_submission=!0,this.alert_variant=this.progress_variant,this.alert_msg=this.initial_msg},hasChanges(s){for(const e in s)if(s[e]!==this.song[e])return this.updateHasChanges(!0),!0;return this.updateHasChanges(!1),!1}}},Z={class:"border border-slate-500 p-3 mb-4 w-full rounded flex justify-between items-center gap-5"},ee={class:"w-full text-base md:text-2xl lg:text-3xl font-semibold overflow-hidden text-ellipsis whitespace-nowrap"},se={class:"w-24"},te=["disabled"],ne=t("i",{class:"fa-regular fa-trash-can"},null,-1),oe=[ne],re=t("i",{class:"fa-solid fa-pen-to-square"},null,-1),ae=[re],ie={class:"mb-4 w-full"},le={id:"form-field",class:"mb-3"},de={class:"inline-block mb-2"},ce={id:"form-field",class:"mb-3"},ue={class:"inline-block mb-2"},ge={id:"form-field",class:"mb-3"},he={class:"inline-block mb-2"},me={id:"form-buttons"},pe=["disabled"],fe=["disabled"];function _e(s,e,r,p,n,a){const o=b("VeeField"),c=b("ErrorMessage"),i=b("VeeForm");return g(),m("main",null,[C(t("section",Z,[t("h4",ee,d(r.song.modified_name),1),t("div",se,[t("button",{class:"w-8 h-8 text-sm rounded text-red-600 float-right md:hover:scale-105 md:hover:bg-gray-800",onClick:e[0]||(e[0]=u((...l)=>a.deleteSong&&a.deleteSong(...l),["prevent"])),disabled:n.in_submission},oe,8,te),t("button",{class:"w-8 h-8 text-sm rounded text-white float-right md:hover:scale-105 md:hover:bg-gray-800",onClick:e[1]||(e[1]=l=>n.showForm=!0)},ae)])],512),[[k,!n.showForm]]),C(t("section",ie,[n.show_alert?(g(),m("p",{key:0,class:f(["text-black text-center font-bold rounded",n.alert_variant])},d(n.alert_msg),3)):N("",!0),h(i,{"validation-schema":n.songSchema,initialValues:n.initialValues,onSubmit:a.editSong},{default:q(()=>[t("div",le,[t("label",de,d(s.$t("manage.form.titleLabel")),1),h(o,{name:"modified_name",label:"Song",type:"text",class:"block w-full py-1.5 px-3 border border-transparent transition duration-500 focus:outline-none focus:border-white rounded",placeholder:"Enter Song Title",onInput:e[2]||(e[2]=l=>r.updateHasChanges(!0))}),h(c,{class:"text-red-600",name:"modified_name"})]),t("div",ce,[t("label",ue,d(s.$t("manage.form.artistLabel")),1),h(o,{name:"artist",type:"text",class:"block w-full py-1.5 px-3 border border-transparent transition duration-500 focus:outline-none focus:border-white rounded",placeholder:"Enter Artist",onInput:e[3]||(e[3]=l=>r.updateHasChanges(!0))}),h(c,{class:"text-red-600",name:"artist"})]),t("div",ge,[t("label",he,d(s.$t("manage.form.genreLabel")),1),h(o,{name:"genre",type:"text",class:"block w-full py-1.5 px-3 border border-transparent transition duration-500 focus:outline-none focus:border-white rounded",placeholder:"Enter Genre",onInput:e[4]||(e[4]=l=>r.updateHasChanges(!0))}),h(c,{class:"text-red-600",name:"genre"})]),t("div",me,[t("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 md:hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",disabled:n.in_submission},d(s.$t("manage.form.buttons.save")),9,pe),t("button",{type:"button",class:"ml-2 py-1.5 px-3 rounded text-white bg-gray-600 md:hover:scale-105 disabled:opacity-50 disabled:cursor-pointer",onClick:e[5]||(e[5]=u(l=>n.showForm=!1,["prevent"])),disabled:n.in_submission},d(s.$t("manage.form.buttons.cancel")),9,fe)])]),_:1},8,["validation-schema","initialValues","onSubmit"])],512),[[k,n.showForm]])])}const be=y(X,[["render",_e]]),ve={name:"Manage",components:{AppUpload:Q,CompositionItem:be},data(){return{songs:[],hasChanges:!1}},async created(){(await v.where("uid","==",_.currentUser.uid).get()).forEach(this.addSong)},methods:{updateSong(s,e){this.songs[s].modified_name=e.modified_name,this.songs[s].genre=e.genre,this.songs[s].artist=e.artist},removeSong(s){this.songs.splice(s,1)},addSong(s){const e={...s.data(),docID:s.id};this.songs.push(e)},updateHasChanges(s){this.hasChanges=s}},beforeRouteLeave(s,e,r){if(!this.hasChanges)r();else{const p=confirm("You have unsaved changes. Are you sure you want to leave?");r(p)}}},xe={class:"bg-zinc-950"},we={class:"grid grid-cols-1 md:grid-cols-3 gap-y-5 md:gap-5 grid-rows-1 mx-5 md:mx-10 my-5"},ye={class:"col-span-2 bg-neutral-900 rounded-lg shadow-inner shadow-slate-500 relative flex flex-col text-white"},Se={class:"px-6 pt-6 pb-5 font-bold border-b border-slate-400"},Ce={class:"card-title"},ke=t("i",{class:"fa-solid fa-music float-right text-green-400 text-2xl"},null,-1),Fe={class:"p-6"},De={key:0},Ee={class:"text-center"};function $e(s,e,r,p,n,a){const o=b("AppUpload"),c=b("CompositionItem");return g(),m("main",xe,[t("div",we,[h(o,{class:"",ref:"upload",addSong:a.addSong},null,8,["addSong"]),t("section",ye,[t("div",Se,[t("span",Ce,d(s.$t("manage.mySongs")+" ("+n.songs.length+")"),1),ke]),t("div",Fe,[n.songs.length===0?(g(),m("div",De,[t("p",Ee,d(s.$t("home.emptyPlaylist")),1)])):(g(!0),m($,{key:1},I(n.songs,(i,l)=>(g(),A(c,{class:"flex flex-col",key:i.docID,song:i,updateSong:a.updateSong,index:l,removeSong:a.removeSong,updateHasChanges:a.updateHasChanges},null,8,["song","updateSong","index","removeSong","updateHasChanges"]))),128))])])])])}const Ue=y(ve,[["render",$e]]);export{Ue as default};
